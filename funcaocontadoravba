Option Explicit ' for√ßa declara√ß√£o de vari√°veis (evita erros de digita√ß√£o)

Function indicadorPro(celulaAtual As Range, _
                      Optional passos As Long = 5, _
                      Optional minimoR As Long = 2) As String
    ' celulaAtual ‚Üí c√©lula onde a f√≥rmula est√° (ex: K2)
    ' passos ‚Üí quantos saltos de -2 colunas verificar (padr√£o = 5)
    ' minimoR ‚Üí quantidade m√≠nima de "R" para retornar "R" (padr√£o = 2)
    ' retorno da fun√ß√£o √© texto ("R" ou "V")
    
    Dim colAtual As Long      ' guarda a coluna da c√©lula atual
    Dim linhaAtual As Long    ' guarda a linha da c√©lula atual
    Dim i As Long             ' contador do loop
    Dim contador As Long      ' conta quantos "R" foram encontrados
    Dim ws As Worksheet       ' refer√™ncia da planilha
    
    ' üîí seguran√ßa: se n√£o veio c√©lula v√°lida, retorna "V"
    If celulaAtual Is Nothing Then
        indicadorPro = "V"
        Exit Function
    End If
    
    ' captura a planilha e posi√ß√£o da c√©lula
    Set ws = celulaAtual.Worksheet
    colAtual = celulaAtual.Column
    linhaAtual = celulaAtual.Row
    contador = 0
    
    ' üîÅ percorre para a esquerda de -2 em -2 colunas
    For i = 1 To passos
        
        ' üõë evita passar da coluna A
        If colAtual - (i * 2) <= 0 Then Exit For
        
        ' üîç verifica se a c√©lula analisada cont√©m "R"
        If ws.Cells(linhaAtual, colAtual - (i * 2)).Value2 = "R" Then
            contador = contador + 1
            
            ' üöÄ early exit: se j√° atingiu o m√≠nimo necess√°rio,
            ' retorna "R" imediatamente (ganho de performance)
            If contador >= minimoR Then
                indicadorPro = "R"
                Exit Function
            End If
        End If
        
    Next i
    
    ' ‚ùå se terminou o loop sem atingir o m√≠nimo, retorna "V"
    indicadorPro = "V"

End Function
